<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Job Explorer (v3 - Checkboxes)</title>
    <style>
      /* 1. VARIABLES CSS & RESET*/
      :root {
        --bg-main: #0a0a0a;
        --bg-secondary: #111111;
        --text: #e0e0e0;
        --gray: #888888;
        --accent: #00ffff;
        --accent-hover: #00cccc;
        --card-bg: #161616;
        --border: #333;
        --modal-overlay: rgba(0, 0, 0, 0.8);
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: "Inter", "Segoe UI", sans-serif;
        background-color: var(--bg-main);
        color: var(--text);
        line-height: 1.6;
      }
      a {
        color: var(--accent);
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }

      /* 2. CONTAINER */
      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }
      header {
        text-align: center;
        margin-bottom: 40px;
        border-bottom: 1px solid var(--border);
        padding-bottom: 20px;
      }
      header h1 {
        color: var(--accent);
        font-size: 2.5rem;
        margin-bottom: 10px;
      }
      .explorer-layout {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 30px;
        align-items: start;
      }
      /* 3. STRUCTURE PRINCIPALE (Nav, Footer) */
      nav {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 5%;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(10px);
        z-index: 1000;
      }

      .logo {
        font-size: 1.4rem;
        font-weight: bold;
        color: var(--accent);
        text-decoration: none;
      }
      .logo span {
        color: white;
      }

      nav ul {
        list-style: none;
        display: flex;
        gap: 2rem;
        align-items: center;
      }
      nav ul li {
        position: relative;
      }
      nav ul li a {
        color: var(--text);
        text-decoration: none;
        transition: 0.3s;
      }
      nav ul li a:hover {
        color: var(--accent);
      }
      nav ul li a.active {
        color: #ff69b4;
        text-shadow: 0 0 8px rgba(255, 105, 180, 0.6);
      }

      .dropdown-content {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        background: #111;
        border-radius: 6px;
        min-width: 160px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      }
      .dropdown-content li {
        display: block;
        padding: 0.5rem 1rem;
      }
      .dropdown-content li a {
        color: var(--gray);
      }
      .dropdown:hover .dropdown-content {
        display: block;
      }
      .guide-download {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border: 1px solid var(--accent, #00ffff);
  border-radius: 999px;
  color: var(--accent, #00ffff);
  font-size: 0.75rem;
  font-weight: 600;
  text-decoration: none;
  background: rgba(0, 0, 0, 0.6);
  transition: all 0.25s ease;
  white-space: nowrap;
}

.guide-download:hover {
  background: var(--accent, #00ffff);
  color: #000;
  box-shadow: 0 0 10px rgba(0, 255, 255, 0.4);
}


      #backToTop {
        position: fixed;
        bottom: 25px;
        right: 25px;
        background: cyan;
        color: #0a0a0a;
        border: none;
        border-radius: 50%;
        width: 55px;
        height: 55px;
        font-size: 1.6rem;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        display: none;
        z-index: 1000;
        transition: all 0.3s ease;
      }
      #backToTop:hover {
        background: #00ffff;
        box-shadow: 0 0 25px rgba(0, 255, 255, 0.7);
        transform: scale(1.15);
      }

      footer {
        text-align: center;
        padding: 2rem;
        font-size: 0.9rem;
        color: var(--gray);
        border-top: 1px solid #222;
      }

      /* 3. PANNEAU DE FILTRES */
      .filter-panel {
        background: var(--bg-secondary);
        padding: 20px;
        border-radius: 12px;
        border: 1px solid var(--border);
        position: sticky;
        top: 20px;
        max-height: 90vh;
        overflow-y: auto;
      }
      .filter-panel h2 {
        color: var(--accent);
        margin-bottom: 20px;
        font-size: 1.5rem;
        border-bottom: 1px solid var(--border);
        padding-bottom: 10px;
      }
      .filter-group {
        margin-bottom: 25px;
      }
      .filter-group label.main-label {
        display: block;
        font-weight: bold;
        margin-bottom: 10px;
        color: var(--text);
      }
      input[type="text"],
      select {
        width: 100%;
        padding: 10px;
        background: #222;
        border: 1px solid var(--border);
        color: var(--text);
        border-radius: 6px;
        font-size: 1rem;
      }
      input[type="text"]:focus {
        outline: none;
        border-color: var(--accent);
      }
      .salary-slider-container {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      input[type="range"] {
        flex-grow: 1;
        cursor: pointer;
      }
      #salary-value {
        font-weight: bold;
        color: var(--accent);
        min-width: 60px;
        text-align: right;
      }
      .toggle-group {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .toggle-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #222;
        padding: 8px 12px;
        border-radius: 6px;
        border: 1px solid var(--border);
      }
      .toggle-item label {
        font-size: 0.9rem;
        cursor: pointer;
      }
      .filter-list {
        max-height: 150px;
        overflow-y: auto;
        background: #1a1a1a;
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 10px;
      }
      .filter-item {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
      }
      .filter-item label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9rem;
        cursor: pointer;
        width: 100%;
      }
      .filter-item input[type="checkbox"] {
        accent-color: var(--accent);
        cursor: pointer;
      }
      #reset-filters {
        width: 100%;
        padding: 12px;
        background: #333;
        color: var(--text);
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        transition: background 0.3s;
      }
      #reset-filters:hover {
        background: #444;
      }

      /* 4. LISTE DES R√âSULTATS */
      .results-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }
      #results-count {
        font-size: 1.2rem;
        color: var(--gray);
      }
      #job-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
      }
      .job-card {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 20px;
        cursor: pointer;
        transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        min-height: 250px;
      }
      .job-card:hover {
        transform: translateY(-5px);
        border-color: var(--accent);
        box-shadow: 0 5px 15px rgba(0, 255, 255, 0.1);
      }
      .job-card h3 {
        color: var(--accent);
        margin-bottom: 10px;
        font-size: 1.2rem;
        line-height: 1.4;
      }
      .job-card .company {
        font-weight: bold;
        margin-bottom: 5px;
      }
      .job-card .location,
      .job-card .salary {
        color: var(--gray);
        font-size: 0.9rem;
        margin-bottom: 5px;
      }
      .job-card .salary {
        color: #4caf50; /* Vert pour le salaire */
        font-weight: bold;
      }
      .skills-preview {
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
      }
      .skill-tag {
        background: #222;
        color: var(--text);
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        border: 1px solid #444;
      }

      /* 5. MODALE (details of the Job) */
      .hidden {
        display: none !important;
      }
      #modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--modal-overlay);
        z-index: 1000;
        backdrop-filter: blur(5px);
      }
      #job-modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--bg-secondary);
        width: 90%;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
        padding: 30px;
        border-radius: 16px;
        border: 1px solid var(--accent);
        z-index: 1001;
        box-shadow: 0 0 30px rgba(0, 255, 255, 0.2);
      }
      #modal-close-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        background: transparent;
        border: none;
        color: var(--gray);
        font-size: 2rem;
        cursor: pointer;
        line-height: 1;
      }
      #modal-close-btn:hover {
        color: var(--accent);
      }
      /* Modal Content Styles */
      #modal-content h2 {
        color: var(--accent);
        margin-bottom: 10px;
      }
      #modal-content h3 {
        color: var(--gray);
        margin-bottom: 20px;
      }
      .modal-description {
        white-space: pre-wrap;
        background: #1a1a1a;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 3px solid var(--accent);
        font-size: 0.95rem;
        max-height: 300px;
        overflow-y: auto;
      }
      .modal-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 20px;
      }
      .modal-tags .skill-tag {
        font-size: 0.85rem;
        padding: 6px 10px;
      }
      .hero-banner-simple {
        padding: 8rem 5% 4rem 5%;
        text-align: center;
      }
      .hero-banner-simple h1 {
        font-size: 3.5rem;
        color: var(--accent);
      }
      .hero-banner-simple .subtitle {
        font-size: 1.5rem;
        color: var(--text);
        margin-top: 1rem;
      }
      /* CURSEUR  */
      .cursor {
        width: 25px;
        height: 25px;
        border: 2px solid var(--accent);
        border-radius: 50%;
        position: fixed;
        left: 0;
        top: 0;
        transform: translate(-50%, -50%);
        transition: transform 0.1s ease;
        z-index: 9999;
        pointer-events: none;
      }

      /* 6. RESPONSIVE DESIGN */
      @media (max-width: 768px) {
        .explorer-layout {
          grid-template-columns: 1fr; /* one colon on mobile */
        }
        .filter-panel {
          position: relative;
          top: 0;
          max-height: none;
        }
      }
    </style>
    <script src="https://d3js.org/d3.v7.min.js"></script>
  </head>
  <body>
    <div class="cursor"></div>
    <nav>
      <a href="/startup" class="logo">Data<span>Universe</span></a>

      <ul class="menu">
        <li><a href="/" class="active">The Observatory</a></li>

        <li class="dropdown">
          <a href="/startup#project" class="dropdown-toggle">Project ‚ñæ</a>
          <ul class="dropdown-content">
            <li><a href="/explanation">Explanation</a></li>
            <li><a href="/startup#objective">Objective</a></li>
            <li><a href="/startup#motivation">Motivation</a></li>
            <li><a href="/startup#tasks">Main Tasks</a></li>
            <li><hr class="dropdown-divider" /></li>
            <li class="dropdown-header">Results</li>
            <li><a href="/startup#expected">Expected Results</a></li>
          </ul>
        </li>

        <li><a href="/index">The Big Picture</a></li>
        <li><a href="/explorateur">The Job Explorer</a></li>
        <li><a href="/tendances">The Hidden Trends</a></li>
        <li><a href="/startup#contact">Contact</a></li>
      </ul>
      <a href="/static/DataUniverse_Guide.pdf" class="guide-download" target="_blank">
  ‚ìò Project Guide
</a>

    </nav>

    <div class="container">
      <header class="hero-banner-simple">
        <h1>The Job Explorer</h1>
        <p class="subtitle">Find your dream job.</p>
      </header>

      <main class="explorer-layout">
        <aside class="filter-panel">
          <h2>Filters</h2>

          <div class="filter-group">
            <label class="main-label" for="filter-text"
              >Search (Title/Desc)</label
            >
            <input
              type="text"
              id="filter-text"
              placeholder="e.g., Data Scientist, Python..."
            />
          </div>

          <div class="filter-group">
            <label class="main-label"
              >Min Salary: <span id="salary-value">$0k</span></label
            >
            <div class="salary-slider-container">
              <span>$0</span>
              <input
                type="range"
                id="filter-salary"
                min="0"
                max="300000"
                step="10000"
                value="0"
              />
              <span>$300k+</span>
            </div>
          </div>

          <div class="filter-group toggle-group">
            <div class="toggle-item">
              <label for="filter-hybrid">Remote/Hybrid Policy</label>
              <input type="checkbox" id="filter-hybrid" />
            </div>
            <div class="toggle-item">
              <label for="filter-visa">Visa Sponsorship</label>
              <input type="checkbox" id="filter-visa" />
            </div>
          </div>

          <div class="filter-group">
            <label class="main-label">Countries</label>
            <div id="filter-country" class="filter-list"></div>
          </div>

          <div class="filter-group">
            <label class="main-label">Seniority Level</label>
            <div id="filter-seniority" class="filter-list"></div>
          </div>

          <div class="filter-group">
            <label class="main-label">Top Technical Skills (AND)</label>
            <div id="filter-skills" class="filter-list"></div>
            <small style="color: var(--gray)"
              >Jobs must have ALL checked skills.</small
            >
          </div>

          <div class="filter-group">
            <label class="main-label">Business Domains (OR)</label>
            <div id="filter-domain" class="filter-list"></div>
          </div>

          <button id="reset-filters">Reset All Filters</button>
        </aside>

        <section class="results-area">
          <div class="results-header">
            <h2 id="results-count">Loading jobs...</h2>
          </div>
          <div id="job-list"></div>
        </section>
      </main>
    </div>

    <div id="modal-backdrop" class="hidden"></div>
    <div id="job-modal" class="hidden">
      <button id="modal-close-btn">&times;</button>
      <div id="modal-content"></div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        console.log(
          "DOM charg√©. Lancement de page2-explorer.js (v3 - Checkboxes)"
        );

        let allJobs = [];

        const dataPath = "/api/stats-data";

        const filterInputs = {
          text: document.getElementById("filter-text"),
          salary: document.getElementById("filter-salary"),
          hybrid: document.getElementById("filter-hybrid"),
          visa: document.getElementById("filter-visa"),
        };
        const filterGroups = {
          country: document.getElementById("filter-country"),
          skills: document.getElementById("filter-skills"),
          seniority: document.getElementById("filter-seniority"),
          domain: document.getElementById("filter-domain"),
        };
        const salaryValueLabel = document.getElementById("salary-value");
        const resultsCount = document.getElementById("results-count");
        const jobList = document.getElementById("job-list");
        const modalBackdrop = document.getElementById("modal-backdrop");
        const modal = document.getElementById("job-modal");
        const modalContent = document.getElementById("modal-content");
        const modalCloseBtn = document.getElementById("modal-close-btn");
        const resetFiltersBtn = document.getElementById("reset-filters");

        fetch(dataPath)
          .then((res) => res.json())
          .then((data) => {
            console.log(`Data loaded successfully from ${dataPath}!`, data[0]);

            allJobs = data.map((d) => ({
              ...d,
              id: +d.id,
              salary_value: d.salary_value != null ? +d.salary_value : null,
              hybrid_policy: !!d.hybrid_policy,
              visa_sponsorship: !!d.visa_sponsorship,

              technical_skills: parseListString(d.technical_skills),
              tools_used: parseListString(d.tools_used),
              domains: parseListString(d.domains),
              soft_skills: parseListString(d.soft_skills),
              tasks: parseListString(d.tasks),
              benefits: parseListString(d.benefits),
            }));

            populateFilters(allJobs);
            updateResults();
            setupListeners();
          })
          .catch((error) => {
            console.error(
              `Erreur lors du chargement des donn√©es depuis ${dataPath}:`,
              error
            );
          });

        // fonctions

        function parseListString(v) {
          if (!v) return [];
          if (Array.isArray(v))
            return v.map((x) => String(x).trim()).filter(Boolean);

          const s = String(v).trim();
          if (!s || s === "[]") return [];
          return s
            .replace(/[\[\]']/g, "")
            .split(/;|,|\|/)
            .map((x) => x.trim())
            .filter(Boolean);
        }

        function getUniqueValues(data, column, isList = false) {
          const valueSet = new Set();
          data.forEach((d) => {
            if (isList && Array.isArray(d[column])) {
              d[column].forEach((item) => valueSet.add(item));
            } else if (!isList && d[column]) {
              valueSet.add(d[column]);
            }
          });
          return Array.from(valueSet)
            .filter((v) => v)
            .sort();
        }

        function getCheckedValues(container) {
          if (!container) return [];
          const checkedInputs = container.querySelectorAll(
            'input[type="checkbox"]:checked'
          );
          return Array.from(checkedInputs).map((input) => input.value);
        }

        function getTopValues(data, column, isList = false, topN = 15) {
          const counts = new Map();

          data.forEach((d) => {
            const raw = d[column];
            const values = isList ? raw || [] : [raw];

            values.forEach((v) => {
              const key = String(v || "").trim();
              if (!key || key === "Not specified") return;
              counts.set(key, (counts.get(key) || 0) + 1);
            });
          });

          return Array.from(counts.entries())
            .map(([name, count]) => ({ name, count }))
            .sort((a, b) => b.count - a.count)
            .slice(0, topN);
        }

        function populateFilters(data) {
          const createCheckboxes = (container, values) => {
            if (!container) return;
            container.innerHTML = "";

            if (values.length === 0) {
              container.innerHTML =
                '<em style="color:var(--gray)">No data available</em>';
              return;
            }

            values.forEach(({ name, count }) => {
              const item = document.createElement("div");
              item.className = "filter-item";
              const escapedVal = name.replace(/"/g, "&quot;");

              item.innerHTML = `
        <label>
          <input type="checkbox" value="${escapedVal}">
          ${name} <small style="color:var(--gray)">(${count})</small>
        </label>
      `;
              container.appendChild(item);
            });
          };

          // Countries ‚Üí top 20
          createCheckboxes(
            filterGroups.country,
            getTopValues(data, "country", false, 20)
          );

          // Seniority ‚Üí top 6
          createCheckboxes(
            filterGroups.seniority,
            getTopValues(data, "seniority_level", false, 6)
          );

          // Technical skills ‚Üí top 15
          createCheckboxes(
            filterGroups.skills,
            getTopValues(data, "technical_skills", true, 15)
          );

          // Domains ‚Üí top 12
          createCheckboxes(
            filterGroups.domain,
            getTopValues(data, "domains", true, 12)
          );

          console.log("Filters (TOP keywords) completed.");
        }

        // events listeners

        function updateResults() {
          const f_text = filterInputs.text.value.toLowerCase().trim();
          const f_salary = +filterInputs.salary.value;
          const f_hybrid = filterInputs.hybrid.checked;
          const f_visa = filterInputs.visa.checked;

          const f_countries = getCheckedValues(filterGroups.country);
          const f_skills = getCheckedValues(filterGroups.skills);
          const f_seniorities = getCheckedValues(filterGroups.seniority);
          const f_domains = getCheckedValues(filterGroups.domain);

          const filteredJobs = allJobs.filter((job) => {
            const textMatch =
              f_text === "" ||
              (job.title && job.title.toLowerCase().includes(f_text)) ||
              (job.description &&
                job.description.toLowerCase().includes(f_text));

            const salaryMatch =
              f_salary === 0 ||
              (job.salary_value && job.salary_value >= f_salary);

            const hybridMatch = !f_hybrid || job.hybrid_policy === true;
            const visaMatch = !f_visa || job.visa_sponsorship === true;

            const countryMatch =
              f_countries.length === 0 || f_countries.includes(job.country);
            const seniorityMatch =
              f_seniorities.length === 0 ||
              f_seniorities.includes(job.seniority_level);

            const skillMatch =
              f_skills.length === 0 ||
              f_skills.every((skill) => job.technical_skills.includes(skill));

            const domainMatch =
              f_domains.length === 0 ||
              f_domains.some((domain) => job.domains.includes(domain));

            return (
              textMatch &&
              salaryMatch &&
              hybridMatch &&
              visaMatch &&
              countryMatch &&
              seniorityMatch &&
              skillMatch &&
              domainMatch
            );
          });

          renderJobs(filteredJobs);
        }

        function renderJobs(jobs) {
          const displayLimit = 50;
          resultsCount.innerText = `${
            jobs.length
          } jobs found. Showing top ${Math.min(jobs.length, displayLimit)}.`;

          jobList.innerHTML = "";
          const jobsToDisplay = jobs.slice(0, displayLimit);

          if (jobsToDisplay.length === 0) {
            jobList.innerHTML =
              '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--gray); font-size: 1.2rem;">No jobs match your criteria. Try removing some filters. üïµÔ∏è‚Äç‚ôÇÔ∏è</div>';
            return;
          }

          jobsToDisplay.forEach((job) => {
            const card = document.createElement("div");
            card.className = "job-card";
            card.dataset.jobId = job.id;

            const salaryText = job.salary_value
              ? `$${job.salary_value.toLocaleString()}`
              : '<span style="color:var(--gray)">Not specified</span>';

            const skillsPreview = job.technical_skills
              .slice(0, 5)
              .map((skill) => `<span class="skill-tag">${skill}</span>`)
              .join("");

            card.innerHTML = `
                          <h3>${job.title}</h3>
                          <div class="company">üè¢ ${
                            job.company || "Confidential"
                          }</div>
                          <div class="location">üìç ${
                            job.location || job.country || "Remote"
                          }</div>
                          <div class="salary">üí∞ ${salaryText}</div>
                          <div class="skills-preview">${skillsPreview} ${
              job.technical_skills.length > 5
                ? `<span class="skill-tag">+${
                    job.technical_skills.length - 5
                  }</span>`
                : ""
            }</div>
                      `;
            jobList.appendChild(card);
          });
        }

        // modal functions

        function showModal(jobId) {
          const job = allJobs.find((j) => j.id === jobId);
          if (!job) return;

          const tagsHtml = (list) =>
            list
              .map((item) => `<span class="skill-tag">${item}</span>`)
              .join("");
          const listHtml = (list) =>
            list.map((item) => `<li>${item}</li>`).join("");

          modalContent.innerHTML = `
                      <h2>${job.title}</h2>
                      <h3>üè¢ ${job.company} | üìç ${job.location}</h3>

                      <div style="margin: 20px 0; display: flex; gap: 15px; flex-wrap: wrap;">
                          ${
                            job.salary_value
                              ? `<span style="color:#4caf50; font-weight:bold;">üí∞ $${job.salary_value.toLocaleString()}</span>`
                              : ""
                          }
                          ${
                            job.hybrid_policy
                              ? '<span style="background:#222; padding:4px 8px; border-radius:4px;">Remote/Hybrid OK</span>'
                              : ""
                          }
                          ${
                            job.visa_sponsorship
                              ? '<span style="background:#222; padding:4px 8px; border-radius:4px;">Visa Sponsorship</span>'
                              : ""
                          }
                      </div>

                      <a href="${
                        job.link
                      }" target="_blank" style="display: inline-block; margin-bottom: 20px; padding: 10px 20px; background: var(--accent); color: #000; font-weight: bold; border-radius: 6px;">
                          üîó Apply / View Original Post on ${job.source}
                      </a>

                      <h4 style="color: var(--accent); margin-top: 20px;">Full Description</h4>
                      <div class="modal-description">${job.description}</div>

                      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 30px;">
                          ${
                            job.technical_skills.length > 0
                              ? `<div><h4 style="color: var(--accent); margin-bottom:10px;">Technical Skills</h4><div class="modal-tags">${tagsHtml(
                                  job.technical_skills
                                )}</div></div>`
                              : ""
                          }
                          ${
                            job.tools_used.length > 0
                              ? `<div><h4 style="color: var(--accent); margin-bottom:10px;">Tools</h4><div class="modal-tags">${tagsHtml(
                                  job.tools_used
                                )}</div></div>`
                              : ""
                          }
                          ${
                            job.soft_skills.length > 0
                              ? `<div><h4 style="color: var(--accent); margin-bottom:10px;">Soft Skills</h4><div class="modal-tags">${tagsHtml(
                                  job.soft_skills
                                )}</div></div>`
                              : ""
                          }
                      </div>

                      ${
                        job.benefits.length > 0
                          ? `<h4 style="color: var(--accent); margin-top: 30px;">Benefits</h4><ul style="margin-left: 20px; color: var(--gray);">${listHtml(
                              job.benefits
                            )}</ul>`
                          : ""
                      }
                  `;
          modal.classList.remove("hidden");
          modalBackdrop.classList.remove("hidden");
          document.body.style.overflow = "hidden";
        }

        function hideModal() {
          modal.classList.add("hidden");
          modalBackdrop.classList.add("hidden");
          modalContent.innerHTML = "";
          document.body.style.overflow = "auto";
        }

        function setupListeners() {
          Object.values(filterInputs).forEach((filter) => {
            if (filter) {
              filter.addEventListener("input", updateResults);
            }
          });

          Object.values(filterGroups).forEach((group) => {
            if (group) {
              group.addEventListener("change", updateResults);
            }
          });

          if (filterInputs.salary && salaryValueLabel) {
            filterInputs.salary.addEventListener("input", (e) => {
              const valK = (e.target.value / 1000).toFixed(0);
              salaryValueLabel.innerText = `$${valK}k`;
            });
          }

          if (resetFiltersBtn) {
            resetFiltersBtn.addEventListener("click", () => {
              filterInputs.text.value = "";
              filterInputs.salary.value = 0;
              salaryValueLabel.innerText = "$0k";
              filterInputs.hybrid.checked = false;
              filterInputs.visa.checked = false;
              document
                .querySelectorAll('.filter-list input[type="checkbox"]')
                .forEach((cb) => (cb.checked = false));
              updateResults();
            });
          }
          if (modalCloseBtn) modalCloseBtn.addEventListener("click", hideModal);
          if (modalBackdrop) modalBackdrop.addEventListener("click", hideModal);
          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && !modal.classList.contains("hidden")) {
              hideModal();
            }
          });

          if (jobList) {
            jobList.addEventListener("click", (event) => {
              const card = event.target.closest(".job-card");
              if (card && card.dataset.jobId) {
                showModal(+card.dataset.jobId);
              }
            });
          }

          console.log("all the listeners are effectif.");
        }
      });
    </script>
  </body>
</html>
